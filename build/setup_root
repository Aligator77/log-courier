#!/bin/bash

# Allow 'go get' to see we already have the log-courier packages by setting
# up a rough Go workspace.

rm -rf src-log-courier
mkdir -p src-log-courier
rm -rf src/github.com/driskell/log-courier
cp -rf src/lc* src-log-courier
mkdir -p src/github.com/driskell/log-courier
mv src-log-courier src/github.com/driskell/log-courier/src

# Go get hangs with older git version if it gets a redirect, bypass gopkg.in
if ! [ -d src/gopkg.in/op/go-logging.v1 ]; then
  git clone --branch v1 https://github.com/op/go-logging.git src/gopkg.in/op/go-logging.v1
fi

# Fake a .git folder for downloaded archives to avoid 'go get' 'Stale checkout'
(
  cd src/github.com/driskell/log-courier
  git init >/dev/null 2>&1
  git add -A >/dev/null 2>&1
  git commit -m 'Master' >/dev/null 2>&1
)
